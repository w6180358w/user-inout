<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试页面2</title>
    <meta name="author" content="pan_junbiao的博客">
    <!--或者下载到本地，下面有下载地址-->
<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="./media/css/jquery.dataTables.min.css">
<link rel="stylesheet" type="text/css" href="./media/css/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="./media/css/bootstrap.min.css">
 
<!-- jQuery -->
<script type="text/javascript" charset="utf8" src="./media/js/jquery.js"></script>
<script type="text/javascript" charset="utf8" src="./media/js/jquery-ui.min.js"></script>
 
<!-- DataTables -->
<script type="text/javascript" charset="utf8" src="./media/js/jquery.dataTables.min.js"></script>

</head>
<body>
<div id="mytool" class="container" style="width:90%">
	<div class="row" style="margin-top:8px;">
		<div class="col-xs-4">
			<div class="col-xs-3">开始时间:</div>
			<div class="col-xs-9"><input style="width:100%" id="startTime"/></div>
		</div>
		<div class="col-xs-5">
			<div class="col-xs-3">结束时间:</div>
			<div class="col-xs-9"><input type="text" id="endTime" style="width:100%"></div>
		</div>
	</div>
	<div class="row" style="margin-top:8px;">
		<div class="col-xs-4">
			<div class="col-xs-3">姓名:</div>
			<div class="col-xs-9"><input style="width:100%" id="name"/></div>
		</div>
		<div class="col-xs-5">
			<div class="col-xs-3">出入口岸:</div>
			<div class="col-xs-9"><input type="text" id="inoutArea" style="width:100%"></div>
		</div>
	</div>
	<div class="row" style="margin-top:8px;">
		<div class="col-xs-4">
			<div class="col-xs-3">出入境:</div>
			<div class="col-xs-9">
				<select style="width:100%" id="inout" onchange="search()">
					<option value="">全部</option>
					<option value="出境">出境</option>
					<option value="入境">入境</option>
				</select>
			</div>
		</div>
		<div class="col-xs-5">
			<div class="col-xs-3">前往地/出发地:</div>
			<div class="col-xs-9"><input type="text" id="target" style="width:100%"></div>
		</div>
		<div class="col-xs-3">
			<input type="file" id="file" accept="xls,xlsx" style="margin-right:5px;" onchange="fileChange(this)"/>
			<button type="button" style="margin-right:5px;" onclick="fileClick()">导入</button>
			<button type="button" style="margin-right:5px;">导出</button>
			<button type="button" style="margin-right:5px;" onclick="cleard()">清空</button>
			<button type="button" onclick="search()">搜索</button>
		</div>
	</div>
</div>
   <!--第二步：添加如下 HTML 代码-->
<table id="table_id_example" class="display" width="97%"></table>
<script type="text/javascript">
var datatable = null;
<!--第三步：初始化Datatables-->
$(document).ready( function () {
	$("#file").hide();
	datatable = $('#table_id_example').DataTable({
        "language": {
            "sProcessing": "处理中...",
            "sLengthMenu": "显示 _MENU_ 项结果",
            "sZeroRecords": "没有匹配结果",
            "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
            "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
            "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
            "sInfoPostFix": "",
            "sSearch": "搜索:",
            "sUrl": "",
            "sEmptyTable": "表中数据为空",
            "sLoadingRecords": "载入中...",
            "sInfoThousands": ",",
            "oPaginate": {
                "sFirst": "首页",
                "sPrevious": "上页",
                "sNext": "下页",
                "sLast": "末页"
            },
            "oAria": {
                "sSortAscending": ": 以升序排列此列",
                "sSortDescending": ": 以降序排列此列"
            }
        },
        "columns": [
            { "title": "人员姓名", orderable: false,data:"name"},
            { "title": "出入标识",orderable: false,data:"inout",width:70},
            { "title": "国籍/地区",orderable: false,data:"area"},
            { "title": "性别" ,data:"sex",width:50},
            { "title": "出生日期" ,data:"birth"},
            { "title": "证件类别",orderable: false ,data:"numType"},
            { "title": "证件号码",orderable: false ,data:"num"},
            { "title": "出入时间" ,data:"time"},
            { "title": "出入口岸" ,data:"inoutArea"},
            { "title": "交通工具",orderable: false ,data:"traffic"},
            { "title": "前往地/出发地" ,data:"target"}
        ],
        order: [[4, 'desc']],
        "dom": "<'row'<'#mytool.col-xs-12'>>" +
        "t" +
        "<'row'<'col-xs-6'i><'col-xs-6'pl>>",
        "serverSide": true,
    	"ajax": {
            "url":"/query",
            "type": "POST",
            "data": function ( d ) {
                //添加额外的参数传给服务器
                d.name = $("#name").val();
                d.inoutArea = $("#inoutArea").val();
                d.target = $("#target").val();
                d.inout = $("#inout").val();
                d.startTime = $("#startTime").val();
                d.endTime = $("#endTime").val();
         	}
         },
         "drawCallback": function( settings ) {
             //渲染完毕后的回调
             //清空全选状态
             $("#table_id_example_length").addClass("dataTables_paginate paging_simple_numbers");
             $("#table_id_example_length").attr("style","padding-top: 0.85em;");
             $("#table_id_example_length").parents("div.row").attr("style","margin-left:10px;margin-right:10px;");
         }
    });
    
    $( "#startTime" ).datepicker({
    	dateFormat:"yy-mm-dd"
    });
    $( "#endTime" ).datepicker({
    	dateFormat:"yy-mm-dd"
    });
    
    $(document).keypress(function(e) { 
    	  if((e.keyCode || e.which)==13) { 
    		  search();
    	  }
    });
} );
function fileClick(){
	$("#file").trigger("click");
}
function fileChange(e){
	var files = $(e).prop('files');
	var data = new FormData();
	data.append('file', files[0]);
	data.append('fileName', files[0].name);
	 
	$.ajax({
		url: '/import',
		type: 'POST',
		data: data,
		cache: false,
		processData: false,
		contentType: false,
		success:function(){
			search();
		},
		failure:function(){
			alert("上传失败!");
		},
		error:function(){
			alert("上传失败!");
			$("#file").val(null);
		}
	});
}
function search(){
	datatable.ajax.reload();
}
function cleard(){
    $("#name").val("");
    $("#inoutArea").val("");
    $("#target").val("");
    $("#inout").val("");
    $("#startTime").val("");
    $("#endTime").val("");
	search();
}
</script>
</body>
</html>